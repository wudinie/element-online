"use strict";(self["webpackChunkelement_show"]=self["webpackChunkelement_show"]||[]).push([[6250],{6250:function(e,t,o){o.r(t),o.d(t,{default:function(){return p}});var a=function(){var e=this,t=e._self._c;return t("el-container",[t("el-header",[t("el-page-header",{attrs:{content:"登录页面"},on:{back:function(t){return e.$router.go(-1)}}})],1),t("el-main",[t("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[t("div",{staticStyle:{"line-height":"50px"},attrs:{slot:"header"},slot:"header"},[t("h2",[e._v("手机号登录")]),t("span",[e._v("未注册的手机号登陆后将会自动注册")])]),t("div",{staticClass:"form"},[t("el-form",{ref:"ruleForm",attrs:{"label-position":e.labelPosition,model:e.formData,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"手机",prop:"mobile"}},[t("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.formData.mobile,callback:function(t){e.$set(e.formData,"mobile",t)},expression:"formData.mobile"}})],1),t("el-form-item",{attrs:{label:"图形验证码",prop:"picCode"}},[t("el-input",{attrs:{placeholder:"请输入图形验证码"},model:{value:e.formData.picCode,callback:function(t){e.$set(e.formData,"picCode",t)},expression:"formData.picCode"}}),e.formData.picUrl?t("el-image",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100px",height:"30px",position:"absolute"},attrs:{src:e.formData.picUrl},on:{click:e.getPicCode}}):e._e()],1),t("el-form-item",{attrs:{label:"短信验证码",prop:"msgCode"}},[t("el-input",{attrs:{placeholder:"请输入短信验证码"},model:{value:e.formData.msgCode,callback:function(t){e.$set(e.formData,"msgCode",t)},expression:"formData.msgCode"}}),t("el-button",{attrs:{type:"text",disabled:e.code},on:{click:function(t){return e.getCode("ruleForm")}}},[e._v(e._s(e.second===e.totalSecond?"获取验证码":e.second+"秒后重新发送"))])],1),t("el-form-item",[t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.login("ruleForm")}}},[e._v("登录")]),t("el-button",{on:{click:function(t){return e.reset("ruleForm")}}},[e._v("重置")])],1)],1)],1)])],1)],1)},s=[],r=o(3476);const i=()=>r.A.get("/captcha/image"),l=(e,t,o)=>r.A.post("/captcha/sendSmsCaptcha",{form:{captchaCode:e,captchaKey:t,mobile:o}}),n=(e,t)=>r.A.post("/passport/login",{form:{isParty:!1,partyData:{},mobile:e,smsCode:t}});var c={name:"LoginIndex",data(){const e=(e,t,o)=>t?/^1[3~9]\d{9}$/.test(this.formData.mobile)?(o(),!0):(o(new Error("输入正确的手机号")),!1):(o(new Error("手机号不能为空")),console.log(this.formData.mobile),console.log(t),!1),t=(e,t,o)=>t?/^\w{4}$/.test(this.formData.picCode)?(o(),!0):(o(new Error("输入正确的图形验证码")),!1):(o(new Error("验证码不能为空")),!1);return{formData:{picCode:"",picKey:"",picUrl:"",mobile:"",msgCode:""},code:!1,totalSecond:60,second:60,timer:null,labelPosition:"left",loading:!0,rules:{mobile:[{validator:e,trigger:"blur"}],picCode:[{validator:t,trigger:"blur"}]}}},async created(){this.getPicCode(),this.loading=!1},methods:{reset(e){this.$refs[e].resetFields()},async getPicCode(){this.loading=!0;const{data:{base64:e,key:t}}=await i();this.formData.picUrl=e,this.formData.picKey=t,console.log(this.formData.picUrl),console.log(t),this.loading=!1},getCode(e){this.$refs[e].validate((async e=>{if(!e)return console.log(e),this.$message.warning("请检查手机号和图形验证码是否正确"),!1;this.code=!0,this.timer||this.second!==this.totalSecond||(this.timer=setInterval((()=>{this.second--,console.log("获取验证码"),this.second<=0&&(clearInterval(this.timer),this.code=!1,this.timer=null,this.second=this.totalSecond)}),1e3)),this.$message.success("短信已发送,注意查收"),await l(this.formData.picCode,this.formData.picKey,this.formData.mobile)}))},async login(e){this.$refs[e].validate((async e=>{if(!e)return this.$message.warning("请输入正确的手机号和图形验证码"),!1;{if(!/^\d{6}$/.test(this.formData.msgCode))return this.$message.warning("请输入正确的手机验证码"),!1;const e=await n(this.formData.mobile,this.formData.msgCode);this.$store.commit("user/setUserInfo",e.data),console.log(e.data),this.$message.success("登录成功");const t=this.$route.query.backUrl||"/";this.$router.replace(t)}}))}},destroyed(){clearInterval(this.timer)}},m=c,d=o(1656),h=(0,d.A)(m,a,s,!1,null,"c089491c",null),p=h.exports}}]);
//# sourceMappingURL=6250.c48803ee.js.map